generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String    @id @default(cuid())
  name               String?
  email              String    @unique
  emailVerified      DateTime?
  image              String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  role               String?
  active             Boolean   @default(true)
  createdBy          String
  updatedBy          String?
  acronisTenantId    String?
  language           String?   @default("tr")
  deleted            Boolean   @default(false)
  partnerAcronisId   String?
  notificationEmails String?
  accounts           Account[]
  sessions           Session[]
  partner            Partner?  @relation(fields: [partnerAcronisId], references: [acronisId])
}

model Account {
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([provider, providerAccountId])
}

model Session {
  sessionToken String   @unique
  userId       String
  expires      DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@id([identifier, token])
}

model Partner {
  id                     String           @id @default(cuid())
  acronisId              String           @unique
  createdBy              String
  createdAt              DateTime         @default(now())
  updatedBy              String?
  updatedAt              DateTime         @updatedAt
  active                 Boolean          @default(true)
  applicationId          String?          @unique
  billingDate            DateTime?
  parentAcronisId        String?
  name                   String?
  licensed               Boolean          @default(true)
  parasutId              String?
  customers              Customer[]
  licenses               License[]
  licenseHistory         LicenseHistory[]
  assignedLicenseHistory LicenseHistory[] @relation("assignHistory")
  application            Application?     @relation(fields: [applicationId], references: [id])
  parent                 Partner?         @relation("parent", fields: [parentAcronisId], references: [acronisId])
  children               Partner[]        @relation("parent")
  users                  User[]
}

model Customer {
  id               String           @id @default(cuid())
  acronisId        String?          @unique
  billingDate      DateTime?
  createdBy        String
  createdAt        DateTime         @default(now())
  updatedBy        String?
  updatedAt        DateTime         @updatedAt
  active           Boolean          @default(true)
  name             String?
  partnerAcronisId String
  partner          Partner          @relation(fields: [partnerAcronisId], references: [acronisId])
  licenses         License[]
  licenseHistory   LicenseHistory[]
}

model License {
  id                String           @id @default(cuid())
  key               String           @unique
  activatedAt       DateTime?
  createdBy         String
  createdAt         DateTime         @default(now())
  updatedBy         String?
  updatedAt         DateTime         @updatedAt
  serialNo          String           @unique
  productId         String
  expiresAt         DateTime?
  assignedAt        DateTime?
  customerAcronisId String?
  partnerAcronisId  String?
  endsAt            DateTime?
  bytes             BigInt?
  customer          Customer?        @relation(fields: [customerAcronisId], references: [acronisId])
  partner           Partner?         @relation(fields: [partnerAcronisId], references: [acronisId])
  product           Product          @relation(fields: [productId], references: [id])
  history           LicenseHistory[]
}

model LicenseHistory {
  id                       String    @id @default(cuid())
  licenseId                String
  partnerAcronisId         String
  previousPartnerAcronisId String?
  customerAcronisId        String?
  action                   String
  createdAt                DateTime  @default(now())
  createdBy                String
  customer                 Customer? @relation(fields: [customerAcronisId], references: [acronisId])
  license                  License   @relation(fields: [licenseId], references: [id], onDelete: Cascade)
  partner                  Partner   @relation(fields: [partnerAcronisId], references: [acronisId])
  previousPartner          Partner?  @relation("assignHistory", fields: [previousPartnerAcronisId], references: [acronisId])
}

model Product {
  id        String    @id @default(cuid())
  code      String    @unique
  name      String
  model     String
  active    Boolean   @default(true)
  createdBy String
  createdAt DateTime  @default(now())
  updatedBy String?
  updatedAt DateTime  @updatedAt
  quota     Int?
  unit      String?
  bytes     BigInt?
  edition   String?
  usageName String?
  annual    Boolean   @default(true)
  freeQuota Boolean   @default(false)
  licenses  License[]
}

model Application {
  id              String    @id @default(cuid())
  companyType     String
  name            String
  taxNo           String
  taxOffice       String
  email           String    @unique
  phone           String
  mobile          String
  address         String
  district        String
  postalCode      String
  applicationDate DateTime
  approvedAt      DateTime?
  approvedBy      String?
  createdAt       DateTime  @default(now())
  createdBy       String
  updatedAt       DateTime  @updatedAt
  updatedBy       String?
  city            Int
  parentAcronisId String
  partner         Partner?
}

model Course {
  id               String    @id @default(cuid())
  category         String
  name             String
  shortDescription String
  description      String?
  duration         String?
  level            String?
  image            String?
  active           Boolean   @default(true)
  createdBy        String
  createdAt        DateTime  @default(now())
  updatedBy        String?
  updatedAt        DateTime  @updatedAt
  link             String?
  type             String    @default("standard")
  chapters         Chapter[]
}

model Chapter {
  id        String   @id @default(cuid())
  courseId  String
  name      String
  active    Boolean  @default(true)
  createdBy String
  createdAt DateTime @default(now())
  updatedBy String?
  updatedAt DateTime @updatedAt
  order     Int
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  lessons   Lesson[]
}

model Lesson {
  id          String   @id @default(cuid())
  chapterId   String
  name        String
  description String?
  link        String
  active      Boolean  @default(true)
  createdBy   String
  createdAt   DateTime @default(now())
  updatedBy   String?
  updatedAt   DateTime @updatedAt
  order       Int
  chapter     Chapter  @relation(fields: [chapterId], references: [id], onDelete: Cascade)
}

model News {
  id          String    @id @default(cuid())
  status      String    @default("draft")
  order       Int
  title       String
  content     String?
  image       String
  publishedAt DateTime?
  createdBy   String
  createdAt   DateTime  @default(now())
  updatedBy   String?
  updatedAt   DateTime  @updatedAt
}

model PotentialPartner {
  id               String    @id @default(cuid())
  companyType      String?
  status           String    @default("potential")
  name             String
  authorizedPerson String?
  taxNo            String?
  taxOffice        String?
  email            String?
  phone            String?
  city             Int
  district         String?
  address          String?
  postalCode       String?
  contactedAt      DateTime?
  note             String?
  createdAt        DateTime  @default(now())
  createdBy        String
  updatedAt        DateTime  @updatedAt
  updatedBy        String?
}

model Notification {
  id         String   @id @default(cuid())
  entityType String
  entityId   String
  sentAt     DateTime @default(now())
  step       Int
  sentTo     String

  @@unique([entityType, entityId, step, sentTo])
}

view v_LicenseReminder {
  licenseId    String?
  serialNo     String?
  customerId   String?
  customerName String?
  productName  String?
  email        String?
  endsAt       DateTime? @db.Timestamp(6)
  daysLeft     Int?
  step         Int?

  @@ignore
}

view v_User {
  id                 String    @unique
  name               String?
  email              String?
  emailVerified      Boolean?
  role               String?
  active             Boolean?
  language           String?
  deleted            Boolean?
  acronisTenantId    String?
  partnerAcronisId   String?
  createdAt          DateTime?
  createdBy          String?
  updatedAt          DateTime?
  updatedBy          String?
  notificationEmails String?
  partnerName        String?
  lastLogin          DateTime?
}

view v_CustomerBillingReminder {
  customerId   String?
  customerName String?
  email        String?
  billingDate  DateTime? @db.Timestamp(6)
  daysLeft     Int?
  step         Int?

  @@ignore
}

view v_License {
  id                     String    @unique
  productId              String?
  productName            String?
  productCode            String?
  bytes                  BigInt?
  productModel           String?
  annual                 Boolean?
  freeQuota              Boolean?
  partnerAcronisId       String?
  partnerName            String?
  partnerParentAcronisId String?
  customerAcronisId      String?
  customerName           String?
  serialNo               String?
  expiresAt              DateTime?
  endsAt                 DateTime?
  assignedAt             DateTime?
  activatedAt            DateTime?
  createdAt              DateTime?
  createdBy              String?
  updatedAt              DateTime?
  updatedBy              String?
}

view v_ActiveLicenses {
  id                     String    @unique
  expiresAt              DateTime?
  activatedAt            DateTime?
  code                   String?
  model                  String?
  quota                  Int?
  unit                   String?
  bytes                  BigInt?
  usageName              String?
  partnerAcronisId       String?
  partnerParentAcronisId String?
  customerAcronisId      String?
}

view v_LicenseHistory {
  id                       String    @unique
  action                   String?
  createdAt                DateTime?
  createdBy                String?
  licenseSerialNo          String?
  productName              String?
  previousPartner          String?
  previousPartnerAcronisId String?
  partner                  String?
  partnerAcronisId         String?
  customer                 String?
}

view v_LicensedCustomers {
  acronisId String?
  name      String?
  code      String?
  model     String?
  quota     Int?
  unit      String?
  bytes     BigInt?

  @@ignore
}

view v_PartnerBillingReminder {
  partnerId   String?
  partnerName String?
  email       String?
  billingDate DateTime? @db.Timestamp(6)
  daysLeft    Int?
  step        Int?

  @@ignore
}
